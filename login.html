<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø±</title>
<style>
body { font-family: Tahoma, sans-serif; background:#f5f5f5; display:flex; flex-direction:column; align-items:center; padding:20px; }
.container { background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,.1); width:400px; margin-bottom:20px; }
h3, h4 { text-align:center; }
input, button, select { width:100%; padding:8px; margin:6px 0; border-radius:5px; font-size:14px; }
input, select { border:1px solid #ccc; }
button { border:none; cursor:pointer; background:#4CAF50; color:#fff; }
button:hover { background:#45a049; }
.blue { background:#2196F3; color:#fff; }
.blue:hover { background:#1976D2; }
.message { font-size:14px; margin-top:6px; }
pre { background:#eee; padding:10px; max-height:200px; overflow:auto; font-size:12px; text-align:left; }
</style>
</head>
<body>

<!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯ -->
<div class="container">
    <h3>ÙˆØ±ÙˆØ¯</h3>
    <input id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
    <input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
    <button onclick="login()">ğŸ” ÙˆØ±ÙˆØ¯</button>
    <div class="message" id="loginMsg"></div>
</div>

<!-- Ø¹Ù…Ù„ÛŒØ§Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø± -->
<div class="container">
    <h3>Ø¹Ù…Ù„ÛŒØ§Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø±</h3>
    <button class="blue" onclick="checkPurchases()">ğŸª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ø±ÛŒØ¯Ù‡Ø§</button>
    <button class="blue" onclick="checkHealth()">â¤ï¸ Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ±</button>

    <h4>Ø«Ø¨Øª Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯</h4>
    <input id="imei1" placeholder="IMEI Ù…ÙˆØ¨Ø§ÛŒÙ„">
    <input id="brand" placeholder="Ø¨Ø±Ù†Ø¯ Ù…ÙˆØ¨Ø§ÛŒÙ„">
    <input id="price" placeholder="Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯">
    <input id="sellerName" placeholder="Ù†Ø§Ù… ÙØ±ÙˆØ´Ù†Ø¯Ù‡">
    <input id="sellerPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³">
    <input id="sellerAddress" placeholder="Ø¢Ø¯Ø±Ø³">
    <input id="sellerFatherName" placeholder="Ù†Ø§Ù… Ù¾Ø¯Ø± ÙØ±ÙˆØ´Ù†Ø¯Ù‡">
    <input type="file" id="sellerPhoto">
    <input type="file" id="idCardPhoto">
    <input type="file" id="thumbPhoto">
    <button onclick="createPurchase()">â• Ø«Ø¨Øª Ø®Ø±ÛŒØ¯</button>
</div>

<!-- ÙØ±Ù… Ø«Ø¨Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ (ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ†) -->
<div class="container">
    <h3>Ø«Ø¨Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ (Ø§Ø¯Ù…ÛŒÙ†)</h3>
    <input id="newUsername" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
    <input id="newPassword" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
    <input id="fullName" placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø§Ù„Ú© Ø¯ÙˆÚ©Ø§Ù†">
    <input id="shopName" placeholder="Ù†Ø§Ù… Ø¯ÙˆÚ©Ø§Ù†">
    <input id="shopPhone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ø¯ÙˆÚ©Ø§Ù†">
    <input id="shopAddress" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯ÙˆÚ©Ø§Ù†">
    <button onclick="createShop()">â• Ø«Ø¨Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø±</button>
    <div class="message" id="shopMsg"></div>
</div>

<!-- Ù¾ÛŒØ§Ù… Ùˆ Ù†ØªÛŒØ¬Ù‡ API -->
<div class="container">
    <div class="message" id="msg"></div>
    <pre id="result"></pre>
</div>

<script>
const BASE_URL = 'http://localhost:5000';

// Ù„Ø§Ú¯ÛŒÙ† Ùˆ Ø°Ø®ÛŒØ±Ù‡ JWT
async function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const msg = document.getElementById('loginMsg');
    msg.textContent = '';
    if(!username || !password){ msg.style.color='red'; msg.textContent='Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª'; return; }

    try{
        const res = await fetch(`${BASE_URL}/api/auth/login`,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({username,password})
        });
        const data = await res.json();
        if(res.ok && data.token){
            localStorage.setItem('token', data.token);
            msg.style.color='green';
            msg.textContent='ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ âœ…';
        } else {
            msg.style.color='red';
            msg.textContent = data.message || 'Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯';
        }
    } catch(err){
        msg.style.color='red';
        msg.textContent='Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±';
        console.error(err);
    }
}

// ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ø¹Ù…ÙˆÙ…ÛŒ
async function callAPI(path,title,auth=true,method='GET',body=null,isFormData=false){
    const msg = document.getElementById('msg');
    const resBox = document.getElementById('result');
    msg.textContent=''; resBox.textContent='';
    const headers = {};
    if(auth){
        const token = localStorage.getItem('token');
        if(!token){ msg.style.color='red'; msg.textContent='Ø§Ø¨ØªØ¯Ø§ Ù„Ø§Ú¯ÛŒÙ† Ú©Ù†ÛŒØ¯'; return; }
        headers['Authorization']='Bearer '+token;
    }
    if(!isFormData) headers['Content-Type']='application/json';
    try{
        const res = await fetch(`${BASE_URL}${path}`,{
            method, headers, body:isFormData?body:body?JSON.stringify(body):null
        });
        const data = await res.json();
        msg.style.color = res.ok?'green':'red';
        msg.textContent = res.ok?`${title} âœ…`:`${title} âŒ`;
        resBox.textContent = JSON.stringify(data,null,2);
    } catch(err){
        msg.style.color='red';
        msg.textContent='Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ API';
        console.error(err);
    }
}

// Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø±
function checkPurchases(){ callAPI('/api/purchases/my-purchases','Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø±'); }

// ØªØ³Øª Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ±
function checkHealth(){ callAPI('/api/health','Ø³Ù„Ø§Ù…Øª Ø³Ø±ÙˆØ±',false); }

// Ø«Ø¨Øª Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯
async function createPurchase(){
    const imei1 = document.getElementById('imei1').value.trim();
    const brand = document.getElementById('brand').value.trim();
    const price = document.getElementById('price').value.trim();
    const sellerName = document.getElementById('sellerName').value.trim();
    const sellerPhone = document.getElementById('sellerPhone').value.trim();
    const sellerAddress = document.getElementById('sellerAddress').value.trim();
    const sellerFatherName = document.getElementById('sellerFatherName').value.trim();
    const sellerPhoto = document.getElementById('sellerPhoto').files[0];
    const idCardPhoto = document.getElementById('idCardPhoto').files[0];
    const thumbPhoto = document.getElementById('thumbPhoto').files[0];

    if(!imei1 || !brand || !price || !sellerName || !sellerPhone || !sellerAddress || !sellerFatherName){
        const msg = document.getElementById('msg');
        msg.style.color='red';
        msg.textContent='ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯';
        return;
    }

    const formData = new FormData();
    formData.append('imei1',imei1);
    formData.append('brand',brand);
    formData.append('price',price);
    formData.append('sellerName',sellerName);
    formData.append('sellerPhone',sellerPhone);
    formData.append('sellerAddress',sellerAddress);
    formData.append('sellerFatherName',sellerFatherName);
    if(sellerPhoto) formData.append('sellerPhoto',sellerPhoto);
    if(idCardPhoto) formData.append('idCardPhoto',idCardPhoto);
    if(thumbPhoto) formData.append('thumbPhoto',thumbPhoto);

    await callAPI('/api/purchases','Ø«Ø¨Øª Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯',true,'POST',formData,true);
}

// Ø«Ø¨Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯ (Ø§Ø¯Ù…ÛŒÙ†)
async function createShop(){
    const username = document.getElementById('newUsername').value.trim();
    const password = document.getElementById('newPassword').value.trim();
    const fullName = document.getElementById('fullName').value.trim();
    const shopName = document.getElementById('shopName').value.trim();
    const shopPhone = document.getElementById('shopPhone').value.trim();
    const shopAddress = document.getElementById('shopAddress').value.trim();
    const msg = document.getElementById('shopMsg');
    msg.textContent = '';

    if(!username || !password || !fullName || !shopName || !shopPhone || !shopAddress){
        msg.style.color='red';
        msg.textContent='ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯';
        return;
    }

    const token = localStorage.getItem('token');
    if(!token){ msg.style.color='red'; msg.textContent='Ø§Ø¨ØªØ¯Ø§ Ù„Ø§Ú¯ÛŒÙ† Ú©Ù†ÛŒØ¯'; return; }

    await callAPI('/api/admin/shops','Ø«Ø¨Øª Ø¯ÙˆÚ©Ø§Ù†Ø¯Ø§Ø± Ø¬Ø¯ÛŒØ¯',true,'POST',{
        username,
        password,
        fullName,
        shopName,
        phone: shopPhone,
        address: shopAddress
    });
}
</script>

</body>
</html>
